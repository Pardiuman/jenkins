pipeline{
    agent none
    stages{
        stage('quality gates check'){
            agent{
                docker {
                    image 'maven:3.8.3-openjdk-17'
                    args '--user root -v /var/run/docker.sock:/var/run/docker.sock'

                }
            }
            environment{
                SONAR_URL="http://172.17.0.1:9000"
            }
            steps{
                script{
                    // withSonarQubeEnv(credentialsId: 'sonar-secret') {
                    //     sh 'cd cicd-project2 && mvn sonar:sonar'
                    // }
                    withCredentials([string(credentialsId: 'sonar-secret', variable: 'AUTH_TOKEN')]) {
                        sh 'cd cicd-project2 && mvn sonar:sonar -Dsonar.login=$AUTH_TOKEN -Dsonar.host.url=${SONAR_URL}'
                    }
                
                
                    sh 'cd cicd-project2 && mvn clean install'
                }
            }

        }   
        
    }
    
}


//     withSonarQubeEnv('sonarqube'){
                //     sh 'mvn sonar:sonar'
                // }