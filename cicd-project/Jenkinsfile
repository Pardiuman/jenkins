pipeline{
    agent none
    parameters{
        string(name: 'DOCKER-NAME', defaultValue: 'JAVA-PROGRAM', description: '')
    }
    environment{
        DOCKER_CREDS = credentials('docker-cred')
        BUILD = "env.BUILD_NUMBER"
        
    }
    stages{
        stage('project build'){
            agent{
                docker{
                    image 'maven'
                    args '--user root'
                }
            }
            steps{
                dir('cicd-project'){
                    sh 'mvn clean install'
                }
                
            }

        }
        stage('send dockerfile to ansible server'){
            environment{
                DOCKERFILE_NAME = "params.DOCKER-NAME"
            }
            agent any
            steps{
                dir('cicd-project'){
                    sshagent(['ssh-ansible']) {

                        sh 'ssh -o StrictHostKeyChecking=no -l ubuntu@3.95.19.73 docker build -t $DOCKER_CREDS_USR/$DOCKERFILE_NAME:$build .'

                    }
                }
            }

        }
    }
}